<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Monitor Satelital - Paxbán</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; background: #222; color: white; }
        #map { height: 750px; width: 100%; border: 2px solid #555; border-radius: 10px; }
        .alerta-header { 
            background: #d40000; color: white; padding: 15px; 
            display: none; text-align: center; font-weight: bold; 
            margin-bottom: 10px; border-radius: 5px; border: 2px solid yellow;
            animation: flash 1s infinite;
        }
        @keyframes flash { 0% {opacity: 1;} 50% {opacity: 0.6;} 100% {opacity: 1;} }
    </style>
</head>
<body>
<div style="background: white; color: black; padding: 10px; position: absolute; top: 100px; left: 20px; z-index: 1000; border-radius: 5px; border: 2px solid #333;">
    <strong>Filtros:</strong><br>
    <input type="checkbox" id="verRegionales" checked onchange="actualizarVista()"> Ver puntos regionales<br>
    <input type="checkbox" id="verSatelite" onchange="cambiarBase()"> Mapa Satélite
</div>

<script>
    var capaBase = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    var sateliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');
    
    var marcadores = L.layerGroup().addTo(map);

    function actualizarVista() {
        marcadores.clearLayers();
        fetch('incendios.json?v=' + Date.now())
            .then(res => res.json())
            .then(data => {
                data.forEach(p => {
                    if (!document.getElementById('verRegionales').checked && !p.alerta) return;
                    
                    L.circleMarker([p.lat, p.lon], {
                        radius: p.alerta ? 12 : 7,
                        fillColor: "red",
                        color: p.alerta ? "yellow" : "white",
                        weight: 2,
                        fillOpacity: 0.9
                    }).addTo(marcadores).bindPopup(p.alerta ? "<b>EMERGENCIA PAXBÁN</b>" : "Calor Regional");
                });
            });
    }

    function cambiarBase() {
        if(document.getElementById('verSatelite').checked) {
            map.removeLayer(capaBase);
            sateliteLayer.addTo(map);
        } else {
            map.removeLayer(sateliteLayer);
            capaBase.addTo(map);
        }
    }
</script>
</body>
</html>
